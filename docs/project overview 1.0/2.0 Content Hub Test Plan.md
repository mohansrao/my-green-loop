# Content Hub & Resource Library - Test Plan

## 1. Overview
This document outlines the testing strategy, tools, and automated test cases for the **Content Hub & Resource Library**. The goal is to ensure the reliability of content curation, metadata fetching, and API interactions.

## 2. Testing Strategy
We utilize a two-pronged approach for automated testing:
*   **Unit Testing**: Isolates specific business logic (e.g., URL parsing) without external dependencies.
*   **Integration Testing**: Verifies the interaction between the API layer and the database, mocking external services where necessary.

### Tools & Libraries
*   **Test Runner**: `jest`
*   **Assertions**: `expect` (Jest built-in)
*   **API Testing**: `supertest`
*   **Backend**: `ts-jest` for TypeScript support

---

## 3. Test Cases

### 3.1 Unit Tests: Metadata Fetcher Service
**File**: `server/services/metadata-fetcher.test.ts`
**Objective**: Ensure the system correctly scrapes and parses metadata from external URLs, handling edge cases gracefully.

| Test Case ID | Description | Input / Scenario | Expected Outcome |
| :--- | :--- | :--- | :--- |
| **UNIT-01** | Standard Article Parsing | HTML with standard OG tags | Returns Title, Description, Image, Type: 'article' |
| **UNIT-02** | YouTube Video Parsing | YouTube URL (`youtube.com/watch?v=...`) | Returns Title (cleaned), High-Res Thumbnail (`maxresdefault`), Type: 'video' |
| **UNIT-03** | Fallback Logic | HTML missing OG tags, has `<title>` | Falls back to `<title>` and `<meta name="description">` |
| **UNIT-04** | Error Handling | Network error / 404 | Returns default empty object, does not crash app |

### 3.2 Integration Tests: Admin API
**File**: `server/tests/content-api.test.ts`
**Objective**: Verify that the Admin API endpoints correctly validate inputs, interact with the database, and return appropriate HTTP status codes.

| Test Case ID | Description | Action | Expected Outcome |
| :--- | :--- | :--- | :--- |
| **INT-01** | Fetch Metadata (Success) | POST `/api/admin/content/fetch-metadata` | 200 OK, JSON with `title`, `thumbnailUrl`, `source` |
| **INT-02** | Duplicate URL Check | POST existing URL to fetch-metadata | 409 Conflict, Error message "already exists" |
| **INT-03** | Create Content | POST `/api/admin/content` with valid data | 201 Created, Returns new Content Object ID |

---

## 4. Execution Instructions

### Prerequisites
Ensure all dependencies are installed:
```bash
npm install
# Ensure dev dependencies are present
npm install --save-dev jest ts-jest @types/jest supertest @types/supertest
```

### Running Tests
To execute the full test suite:
```bash
npm test
```

### Expected Output
The test runner should output a summary of passing tests:
```text
 PASS  server/services/metadata-fetcher.test.ts
 PASS  server/tests/content-api.test.ts

Test Suites: 2 passed, 2 total
Tests:       7 passed, 7 total
Snapshots:   0 total
Time:        1.234 s
```
